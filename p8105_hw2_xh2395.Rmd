---
title: "p8105_hw2_xh2395"
author: "Xin  He"
date: "9/27/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(readxl)
```


## Problem 1
**Read and clean the Mr. Trash Wheel sheet:**
```{r}
Mr_Trash_data = 
  read_excel(path = "./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", sheet = "Mr. Trash Wheel", range = cell_cols("A:N")) %>% 
  janitor::clean_names() %>%
  drop_na(dumpster) %>% 
  mutate(sports_balls = as.integer(round(sports_balls)))
```

**Read and clean precipitation data for 2018**
```{r}
preci2018_data = 
  read_excel(path = "./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", sheet = "2018 Precipitation", range = "A2:B14") %>% 
  janitor::clean_names() %>%
  drop_na(total) %>% 
  mutate(year = 2018)
```

**Read and clean precipitation data for 2017**
```{r}
preci2017_data = 
  read_excel(path = "./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", sheet = "2017 Precipitation", range = "A2:B14") %>% 
  janitor::clean_names() %>%
  drop_na(total) %>% 
  mutate(year = 2017)
```

**Combine precipitation datasets**
```{r}
com_data = full_join(preci2017_data, preci2018_data, by = NULL) %>% 
  mutate(month = month.name[month])
```

In dataset "Mr_Trash_data", the number of observations is `r nrow(Mr_Trash_data)`, and the number of variables is `r ncol(Mr_Trash_data)`. Key variables include "dumpster" and "sports_balls". 

In dataset "preci2018_data", the number of observations is `r nrow(preci2018_data)`, and the number of variables is `r ncol(preci2018_data)`. Key variables include "year", "month" and "total".

In dataset "preci2017_data", the number of observations is `r nrow(preci2017_data)`, and the number of variables is `r ncol(preci2017_data)`. Key variables include "year", "month" and "total".

In dataset "com_data", the number of observations is `r nrow(com_data)`, and the number of variables is `r ncol(com_data)`. Key variables include "year", "month" and "total".

The total precipitation in 2018 is `r sum(0.96+5.30+2.18+3.20+9.27+0.20+2.39)` inches.

The median number of sports balls in a dumpster in 2017 is `r median(Mr_Trash_data$ sports_balls)`.


## Problem 2
**Clean the data in pols-month.csv**
```{r}
pols_data = 
  read_csv("./data/pols-month.csv") %>% 
  janitor::clean_names() %>%
  separate(mon, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(year = as.integer(year), month = as.integer(month), day = as.integer(day)) %>% 
  mutate(month = month.name[month]) %>% 
  mutate(president = ifelse(prez_gop %in% 0, "dem",
     ifelse(prez_gop %in% 1, "gop", "gop"))) %>% 
  select(-prez_gop, -prez_dem, -day)
```

**Clean the data in snp.csv**
```{r}
snp_data = 
  read_csv("./data/snp.csv") %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("month", "day", "year"), sep = "/") %>% 
  mutate(year = as.integer(year), month = as.integer(month), day = as.integer(day)) %>% 
  mutate(month = month.name[month]) %>% 
  select(-day) %>% 
  arrange(year, month) %>% 
  select("year", everything())
```

**Tidy the unemployment data**
```{r}
unemploy_data = 
  read_csv("./data/unemployment.csv") %>% 
  rename(January = Jan, February = Feb, March = Mar, April =  Apr, June = Jun, July = Jul,     Auguest = Aug, September = Sep, October = Oct, November = Nov, December = Dec)

unemploy_tidy_data = 
  pivot_longer(
    unemploy_data, 
    January:December,
    names_to = "month", 
    values_to = "unemployment") %>% 
  janitor::clean_names()
```

**Join the datasets by merging snp into pols**
```{r}
pols_snp_data = 
  left_join(pols_data, snp_data, by = c("year", "month"))
```

**Merging unemployment**
```{r}
p_s_unemploy_data = 
  left_join(pols_snp_data, unemploy_tidy_data, by = c("year", "month"))
```

In dataset "pols_data", the number of observations is `r nrow(pols_data)`, and the number of variables is `r ncol(pols_data)`. Key variables include "year", "month" and "president". Range of years in this data is 1947-2015.

In dataset "snp_data", the number of observations is `r nrow(snp_data)`, and the number of variables is `r ncol(snp_data)`. Key variables include "year", "month" and "close". Range of years in this data is 1950-2015.

In dataset "unemploy_tidy_data", the number of observations is `r nrow(unemploy_tidy_data)`, and the number of variables is `r ncol(unemploy_tidy_data)`. Key variables include "year", "month" and "unemployment". Range of years in this data is 1948-2015.

In dataset "pols_snp_data", the number of observations is `r nrow(pols_snp_data)`, and the number of variables is `r ncol(pols_snp_data)`. Key variables include "year", "month", "president" and "close". Range of years in this data is 1947-2015.

The resulting dataset "p_s_unemploy_data", merged previous three datasets "pols_data", "snp_data" and "unemploy_tidy_data" together by year and month. In the resulting dataset, the number of observations is `r nrow(p_s_unemploy_data)`, and the number of variables is `r ncol(p_s_unemploy_data)`. Key variables include "year", "month", "president","close" and "unemployment". Range of years in this data is 1947-2015.








